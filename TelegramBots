import telebot
from telebot import types
import os

bot = telebot.TeleBot("8533334705:AAFfoqFR4a7XZY5SHfAfDlQVRCSfhUWqmHk")

data = {}

@bot.message_handler(commands=['start'])
def start(message):
    chat_id = message.chat.id
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    btn_python = types.KeyboardButton("Python")
    btn_photoshop = types.KeyboardButton("Photoshop")
    btn_kompyuter_sawatqaniligi = types.KeyboardButton("Kompyuter Sawatqanligi")
    btn_android_dasturlew = types.KeyboardButton("Android Dasturlew")
    btn_back = types.KeyboardButton("ORTGA")
    markup.add(btn_python, btn_photoshop, btn_kompyuter_sawatqaniligi, btn_android_dasturlew, btn_back)
    data[chat_id] = {}
    bot.send_message(chat_id, "Salem Siz Diverse IT Academy Botina Xosh Kelibsiz \n"
    "Bottan Paydalaniw  Ushun Tomendegi Kurslardin Birin Tanlan", reply_markup=markup, parse_mode='Markdown')

@bot.message_handler(content_types=['text'])
def reply_message(message):
    chat_id = message.chat.id
    user = data.setdefault(chat_id, {})
    if message.text == "ORTGA":
        start(message)
        return
    if 'service' not in user:
        if message.text in ["Python", "Photoshop", "Kompyuter Sawatqanligi", "Android Dasturlew"]:
            user['service'] = message.text
            markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
            btn_register = types.KeyboardButton("Dizimnen Otin")
            btn_back = types.KeyboardButton("ORTGA")
            markup.add(btn_register, btn_back)
            bot.send_message(chat_id, f"{message.text} Uchun Dizimnen Otin.", reply_markup=markup)
        else:
            bot.send_message(chat_id, "Iltimas Bar Tayyarliq Kurslardin Birin Tanlan")
        return

    if 'register' not in user and message.text == "Dizimnen Otin":
        user['register'] = True
        rm = types.ReplyKeyboardRemove()
        bot.send_message(chat_id, "Atinizdi Kiritin:", reply_markup=rm)
        return

    if 'register' in user and 'name' not in user:
        user['name'] = message.text
        bot.send_message(chat_id, "Familiyanizdi Kiritin:")
        return

    if 'register' in user and 'surname' not in user:
        user['surname'] = message.text
        bot.send_message(chat_id, "Jasinizdi Kiritin:")
        return

    if 'register' in user and 'age' not in user:
        user['age'] = message.text
        bot.send_message(chat_id, "Akenizdin Atin Kiritin:")
        return

    if 'register' in user and 'father_name' not in user:
        user['father_name'] = message.text
        channel_username = "@DizimAliwshi"
        text_to_send = f"Basladi - {user['service']} - Dizimnen Otti - Ati {user['name']} - Familiyasi {user['surname']} - Jasi {user['age']} - Akesinin Ati {user['father_name']}"
        try:
            bot.send_message(channel_username, text_to_send)
        except Exception as e:
            print(f"Kanalga yuborishda xatolik: {e}")
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
        btn_back = types.KeyboardButton("ORTGA")
        markup.add(btn_back)
        bot.send_message(chat_id, "Raxmet Eger Sorawlariniz Bolsa Bizge Murajat Qilin \n"
        "ðŸ‘§ Murajat Ushin: @diversemanager", reply_markup=markup)
        del data[chat_id]
        return

bot.infinity_polling()
